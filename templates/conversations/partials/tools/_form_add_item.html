{% comment %}Edit form for add_item tool call.{% endcomment %}
<div class="space-y-3">
    <div>
        <label class="block text-xs font-medium text-gray-600 mb-1">Order ID</label>
        <input type="text" name="arg_orderId" value="{{ d.raw_args.orderId }}"
            class="w-full rounded-md border border-gray-300 px-3 py-1.5 text-sm focus:border-indigo-500 focus:outline-none">
    </div>

    <div class="grid grid-cols-2 gap-3">
        <div>
            <label class="block text-xs font-medium text-gray-600 mb-1">Item Name</label>
            <input type="text" name="arg_itemName" value="{{ d.raw_args.itemName }}"
                class="w-full rounded-md border border-gray-300 px-3 py-1.5 text-sm focus:border-indigo-500 focus:outline-none">
        </div>
        <div>
            <label class="block text-xs font-medium text-gray-600 mb-1">Quantity</label>
            <input type="number" name="arg_quantity" value="{{ d.raw_args.quantity|default:'1' }}" min="1"
                class="w-full rounded-md border border-gray-300 px-3 py-1.5 text-sm focus:border-indigo-500 focus:outline-none">
        </div>
    </div>

    <div>
        <label class="block text-xs font-medium text-gray-600 mb-1">Modifiers (comma-separated)</label>
        <input type="text" id="add_item_modifiers_display_{{ tc.pk }}" value="{{ d.modifiers|join:', ' }}" placeholder="e.g. extra cheese, no onions"
            class="w-full rounded-md border border-gray-300 px-3 py-1.5 text-sm focus:border-indigo-500 focus:outline-none">
        <input type="hidden" name="arg_modifiers" id="arg_modifiers_{{ tc.pk }}">
    </div>

    <div>
        <label class="block text-xs font-medium text-gray-600 mb-1">Special Instructions</label>
        <input type="text" name="arg_specialInstructions" value="{{ d.raw_args.specialInstructions }}"
            class="w-full rounded-md border border-gray-300 px-3 py-1.5 text-sm focus:border-indigo-500 focus:outline-none">
    </div>
</div>

<script>
(function() {
    var form = document.getElementById('arg_modifiers_{{ tc.pk }}').closest('form');
    form.addEventListener('submit', function() {
        var modsStr = document.getElementById('add_item_modifiers_display_{{ tc.pk }}').value.trim();
        var modifiers = modsStr ? modsStr.split(',').map(function(m) {
            return {name: m.trim(), portion: 'whole'};
        }).filter(function(m) { return m.name; }) : [];
        document.getElementById('arg_modifiers_{{ tc.pk }}').value = JSON.stringify(modifiers);
    });
})();
</script>
